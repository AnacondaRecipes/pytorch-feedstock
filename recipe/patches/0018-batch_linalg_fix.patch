From: James Robertson 
Date: Tue, 27 May 2025 10:30:45 +0100
Subject: [PATCH] Fix conjugated and negated views not handled
Issue: https://github.com/pytorch/pytorch/issues/150918
--- aten/src/ATen/native/BatchLinearAlgebra.cpp	2025-05-08 10:44:15.309238836 +0100
+++ "aten/src/ATen/native/BatchLinearAlgebra copy.cpp"	2025-05-21 10:08:48.175572320 +0100
@@ -3860,7 +3860,14 @@
               x.scalar_type(), " and y of type ", y.scalar_type(), " instead");
   // Computes x^H y
   if (x.dim() == 1 && y.dim() == 1) {
-    return at::vdot(x, y);
+    // Handle conjugated and negated views properly instead of using at::vdot
+    auto x_tensor = x.resolve_conj().conj();  // Always resolve first, then conjugate for Hermitian
+    auto y_tensor = y.resolve_conj();         // Always resolve to get actual tensor data
+    
+    // Handle negation views
+    x_tensor = x_tensor.is_neg() ? x_tensor.resolve_neg() : x_tensor;
+    y_tensor = y_tensor.is_neg() ? y_tensor.resolve_neg() : y_tensor;
+    
+    return x_tensor.dot(y_tensor);
   } else {
     return x.conj().mul(y).sum(/*dim=*/dim);
   }
