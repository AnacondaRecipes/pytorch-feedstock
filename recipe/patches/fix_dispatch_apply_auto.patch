--- a/third_party/pthreadpool/src/gcd.c
+++ b/third_party/pthreadpool/src/gcd.c
@@ -119,6 +119,9 @@ PTHREADPOOL_INTERNAL void pthreadpool_parallelize(
 		range_start = range_end;
 	}
 
+	#ifndef DISPATCH_APPLY_AUTO
+	#define DISPATCH_APPLY_AUTO ((dispatch_queue_t _Nonnull)0)
+	#endif
 	dispatch_apply_f(threads_count.value, DISPATCH_APPLY_AUTO, threadpool, thread_main);
 
 	/* Unprotect the global threadpool structures */
